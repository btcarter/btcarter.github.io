<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>SLURM Computing | B.T. Carter</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="SLURM Computing" />
<meta name="author" content="Benjamin Carter" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Purpose" />
<meta property="og:description" content="Purpose" />
<link rel="canonical" href="http://localhost:4000/courses/tutorials/fmri/2018-09-10-slurm.html" />
<meta property="og:url" content="http://localhost:4000/courses/tutorials/fmri/2018-09-10-slurm.html" />
<meta property="og:site_name" content="B.T. Carter" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-10T00:00:00-06:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/courses/tutorials/fmri/2018-09-10-slurm.html","headline":"SLURM Computing","dateModified":"2018-09-10T00:00:00-06:00","datePublished":"2018-09-10T00:00:00-06:00","author":{"@type":"Person","name":"Benjamin Carter"},"description":"Purpose","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/courses/tutorials/fmri/2018-09-10-slurm.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="B.T. Carter" />
  
</head>


  <body>

    <header class="site-header" role="banner">
  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/"><img src="/files/images/midsag.jpg" alt="Midsagittal brain" style="width:10%;">B.T. Carter</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/publications/">Publications</a>
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SLURM Computing</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-09-10T00:00:00-06:00" itemprop="datePublished">
        
        Sep 10, 2018
      </time>
      
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Benjamin Carter</span></span>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <hr>
<h3>Purpose</h3>

	<p>This tutorial gives an overview of SLURM computing and how to use it to submit and execute various jobs.</p>

<h3>Learning Outcomes</h3>

<p>By the end of this tutorial, you should be able to meet the following objectives:
</p>

	<ol>
		<li>Explain what the SLURM is.</li>
		<li>Be able to define various options used to allocate resources to a job script.</li>
		<li>Be able to write a job script.</li>
		<li>Be able to submit multiple job scripts using a single batch script.</li>
	</ol>
<hr>

<h2>Introduction to the BYU Supercomputer</h2>

<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/i1r9BxHBG0I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/h8TZokyI6yo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</center>

<h2>What is the SLURM?</h2>

<p>The SLURM (<a href="https://en.wikipedia.org/wiki/Slurm_Workload_Manager">Simple Linux Utility for Resource Management</a>) is a job scheduler used by the supercomputer to assign resources to a job and a place in the queue when computing resources are scarce. Jobs can either be submitted directly by the user or can be submitted by a script (which allows the use of features like a for loop).
</p>

<h3>SLURM commands and tools</h3>

<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/U42qlYkzP9k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</center>

<h3>Job scripts</h3>

<p>Job scripts require the necessary information to allocate supercomputer resources to and execute a series of commands. It has two parts, a preamble and the job itself. The preamble lists the resources to run the job on the supercomputer. You should always include a preamble within each job script otherwise the script will not run. The job lists all modules, programs and commands necessary and looks like a typical script.
</p>

<h4>Elements of the preamble</h4>
<ol>
	<li><p><code>#SBATCH</code> denotes that a line contains parameters relevant to the <code>sbatch</code> command. Vital elements include walltime, the number of processing cores, the number of nodes, and memory per CPU core. These can be written in one line or several (so long as each line begins with <code>#SBATCH</code>). Additional elements can be added such as a job name so you can identify it within the queue, and whether or not the program should email you once the job has started, failed or finished (I would suggest using that option judiciously as you could end up spamming your inbox to death). The Fulton Lab also has a <a href="https://marylou.byu.edu/documentation/slurm/script-generator">job script generator</a> you can use. After the preamble, the remaining code needs to contain all the modules, commands and programs you would like to run.
	</p></li>

	<li><p>Walltime(<code>--time</code>) is a time limit set for the job to run. This information is used to determine the job's position in the queue, as well as ensure job ends should it accidentally result in a recursive loop.</p></li>

	<li><p>The number of processor cores (<code>--ntasks</code>) is the number of processing units required for the job. It is a subunit of a CPU (central processing unit) and performs all basic computational tasks.</p></li>

	<li><p>The number of nodes (<code>--nodes</code>) can be described as the number of or computers required for the job.</p></li>

	<li><p>Memory per CPU core (<code>--mem-per-cpu</code>) is the amount of memory you would like to allocated to a single core per CPU for the job and is listed in megabytes (M). The amount of memory will also influence the speed at which the job is executed.</p></li>
</ol>

<h4>Job Script</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="c">#SBATCH --time=01:00:00   # walltime</span>
<span class="c">#SBATCH --ntasks=1   # number of processor cores (i.e. tasks)</span>
<span class="c">#SBATCH --nodes=1   # number of nodes</span>
<span class="c">#SBATCH --mem-per-cpu=1024M   # memory per CPU core</span>
<span class="c">#SBATCH -J "MartyMcFly"   # job name</span>
<span class="c">#SBATCH --mail-user=&lt;email@domain.com&gt;   # email address</span>
<span class="c">#SBATCH --mail-type=FAIL</span>

<span class="c"># Compatibility variables for PBS. Delete if not needed.</span>
<span class="nb">export </span><span class="nv">PBS_NODEFILE</span><span class="o">=</span><span class="sb">`</span>/fslapps/fslutils/generate_pbs_nodefile<span class="sb">`</span>
<span class="nb">export </span><span class="nv">PBS_JOBID</span><span class="o">=</span><span class="nv">$SLURM_JOB_ID</span>
<span class="nb">export </span><span class="nv">PBS_O_WORKDIR</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SLURM_SUBMIT_DIR</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">PBS_QUEUE</span><span class="o">=</span>batch

<span class="c"># Set the max number of threads to use for programs using OpenMP. Should be &lt;= ppn. Does nothing if the program doesn't use OpenMP.</span>
<span class="nb">export </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="nv">$SLURM_CPUS_ON_NODE</span>

<span class="c"># LOAD MODULES, INSERT CODE, AND RUN YOUR PROGRAMS HERE</span></code></pre></figure>

<h3>Batch script</h3>

<p>Up to this point we have been using serial computing in which we submit single jobs and wait for their completion before submitting the next job. This can be a slow and tedious process, especially for complex tasks. Breaking up large tasks into smaller tasks that can be performed simultaneously can increase the rate of job completion. This is done via the <em>batch script</em> using the command <code>sbatch</code> followed by various options,  path to the job script as well as any variables that must be passed on to the job script. The <code>sbatch</code> command can be embedded in a for loop to submit multiple jobs at once.
</p>

<h4>Example Batch Script</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for </span>i <span class="k">in</span> &lt;list of iterations&gt;
    <span class="k">do
    </span>sbatch <span class="se">\</span>
        <span class="nt">-o</span> &lt;output file path&gt; <span class="se">\</span>
        <span class="nt">-e</span> &lt;error file path&gt; <span class="se">\</span>
        &lt;job script path&gt; <span class="se">\</span>
        <span class="nv">$i</span>
        <span class="nb">sleep </span>1
<span class="k">done</span></code></pre></figure>

<!--
<hr>

<h2>Slides</h2>

<center>
<iframe src="//slides.com/bencarter-1/thecommandline/embed" width="576" height="420" scrolling="no" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</center>
 -->


<hr>
<h2>Additional Resources</h2>

<p><a href="https://www.youtube.com/user/BYUSupercomputing">BYU Supercomputing YouTube Channel</a></p>

<p><a href="https://marylou.byu.edu/documentation/">Fulton Supercomputing Lab Documentation</a></p>

  </div>

  

  <a class="u-url" href="/courses/tutorials/fmri/2018-09-10-slurm.html" hidden></a>

  <!-- this adds math functionality -->
  

</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">B.T. Carter</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Benjamin T. Carter
            
            </li>
            
            <li><a class="u-email" href="mailto:ben88@byu.edu">ben88@byu.edu</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/btcarter"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">btcarter</span></a></li>
  
  
  
  <li><a href="https://www.twitter.com/aReadingApe"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">aReadingApe</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>A website dedicated to all things neuroscience, neuroimaging, tutorials, graduate school, and the endless wheel of scientific inquiry. © 2019 Benjamin Carter.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
